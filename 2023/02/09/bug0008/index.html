<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"security-kitchen.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"./public/search.json"};
  </script>

  <meta name="description" content="前言本文为Android漏洞之战技巧篇的最后一个篇幅，前面我们依次讲了Hook、脱壳、反调、过签等，本文主要初步讲解Ollvm混淆与反混淆，本文收集整理了网络上开源的实验样本和脚本，实验脚本上传至github，实验样本上传至知识星球：安全后厨。">
<meta property="og:type" content="article">
<meta property="og:title" content="Android App漏洞之战（8）——（反混淆）Ollvm混淆与反混淆">
<meta property="og:url" content="http://security-kitchen.com/2023/02/09/bug0008/index.html">
<meta property="og:site_name" content="欢迎来到安全后厨！">
<meta property="og:description" content="前言本文为Android漏洞之战技巧篇的最后一个篇幅，前面我们依次讲了Hook、脱壳、反调、过签等，本文主要初步讲解Ollvm混淆与反混淆，本文收集整理了网络上开源的实验样本和脚本，实验脚本上传至github，实验样本上传至知识星球：安全后厨。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/1.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/2.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/3.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/4.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/5.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/6.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/7.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/8.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/9.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/10.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/11.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/12.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/13.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/14.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/15.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/16.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/17.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/18.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/19.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/20.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/21.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/22.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/23.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/24.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/25.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/26.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/27.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/28.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/29.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/30.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/31.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/32.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/33.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/34.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/36.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/35.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/43.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/38.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/39.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/37.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/40.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/41.png">
<meta property="og:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/42.png">
<meta property="article:published_time" content="2023-02-09T02:41:19.000Z">
<meta property="article:modified_time" content="2023-12-23T09:13:44.110Z">
<meta property="article:author" content="安全后厨团队">
<meta property="article:tag" content="漏洞挖掘">
<meta property="article:tag" content="工具">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/1.png">

<link rel="canonical" href="http://security-kitchen.com/2023/02/09/bug0008/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Android App漏洞之战（8）——（反混淆）Ollvm混淆与反混淆 | 欢迎来到安全后厨！</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="欢迎来到安全后厨！" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
	<div class="headband"></div>
    <a target="_blank" rel="noopener" href="https://github.com/WindXaa?tab=repositories" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">欢迎来到安全后厨！</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="fa fa-download fa-fw"></i>资源</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://security-kitchen.com/2023/02/09/bug0008/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="安全后厨团队">
      <meta itemprop="description" content="选择有时候比努力更重要">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="欢迎来到安全后厨！">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Android App漏洞之战（8）——（反混淆）Ollvm混淆与反混淆
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-02-09 10:41:19" itemprop="dateCreated datePublished" datetime="2023-02-09T10:41:19+08:00">2023-02-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-23 17:13:44" itemprop="dateModified" datetime="2023-12-23T17:13:44+08:00">2023-12-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android-APP%E6%BC%8F%E6%B4%9E%E4%B9%8B%E6%88%98/" itemprop="url" rel="index"><span itemprop="name">Android APP漏洞之战</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文为Android漏洞之战技巧篇的最后一个篇幅，前面我们依次讲了Hook、脱壳、反调、过签等，本文主要初步讲解Ollvm混淆与反混淆，本文收集整理了网络上开源的实验样本和脚本，实验脚本上传至github，实验样本上传至知识星球：安全后厨。</p>
<span id="more"></span>
<p>本文收集整理了网上已有大佬们使用的一些开源脚本和样例，帮助初学者初步了解和学习Ollvm混淆和反混淆，脚本的原理和具体讲解参考文章链接或知识星球中的内容，本文考虑篇幅不做过多讲解。本文的结构主要分为：</p>
<p>第一节介绍Ollvm混淆</p>
<p>第二节介绍Ollvm反混淆的常见方法</p>
<p>第三节进行Ollvm反混淆实操</p>
<h2 id="1-Ollvm"><a href="#1-Ollvm" class="headerlink" title="1.Ollvm"></a>1.Ollvm</h2><h3 id="1-1-ollvm简介"><a href="#1-1-ollvm简介" class="headerlink" title="1.1 ollvm简介"></a>1.1 ollvm简介</h3><p>LLVM(Obfuscator-LLVM)是瑞士西北应用科技大学安全实验室于2010年6月份发起的一个项目,该项目旨在提供一套开源的针对LLVM的代码混淆工具,以增加对逆向工程的难度。github上地址是<a target="_blank" rel="noopener" href="https://github.com/obfuscator-llvm/obfuscator">https://github.com/obfuscator-llvm/obfuscator</a> ，只不过仅更新到llvm的4.0，2017年开始就没在更新。</p>
<p>想了解OLLVM，首先需要明白LLVM是什么。简而言之，LLVM是模块化和可重用的编译器和工具链技术的集合。具体的过程如下图所示：</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/1.png"></p>
<p>即需要完成如下的步骤：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">源代码（c/c++）经过clang--&gt; 中间代码(经过一系列的优化，优化用的是Pass) --&gt; 机器码</span><br></pre></td></tr></table></figure>

<p>llvm正是因为将不同的语言转换为中间语言IR，然后通过编写一系列的Pass进行优化，最后在针对不同平台进行转换，所以可以支持不同平台</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/2.png"></p>
<p>我们前面提到了Pass，而llvm通过编写Pass将中间语言IR进行优化，而Ollvm则是通过编写更加复杂的Pass，将代码复杂化，这样就达到了混淆的目的。</p>
<h3 id="1-2-ollvm分类"><a href="#1-2-ollvm分类" class="headerlink" title="1.2 ollvm分类"></a>1.2 ollvm分类</h3><p>前面我们已经知晓了ollvm的原理，那么这里我们理解最原始的ollvm的分类就变得更加容易。官方的Ollvm更新到llvm的4.0，目前主要分为：指令替换、虚假控制流、控制流平坦化。当然后面越来越多的人编写了更加复杂的Pass，这里我们就不具体深究了。</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/3.png" alt="image-20220921201852889"></p>
<p>下面我们简单的介绍每个Pass的实现原理</p>
<h4 id="1-2-1-指令替换（Sub）"><a href="#1-2-1-指令替换（Sub）" class="headerlink" title="1.2.1 指令替换（Sub）"></a>1.2.1 指令替换（Sub）</h4><p>指令替换，将一条运算指令，替换为多条等价的运算指令。例如：<code>y=x+1</code>变为<code>y=x+1-1</code></p>
<h4 id="1-2-2-虚假控制流（bcf）"><a href="#1-2-2-虚假控制流（bcf）" class="headerlink" title="1.2.2 虚假控制流（bcf）"></a>1.2.2 虚假控制流（bcf）</h4><p>虚假控制流混淆主要通过加入包含不透明谓词的条件跳转和不可达的基本块，来干扰IDA的控制流分析和F5反汇编</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/4.png" alt="image-20220921202830658"></p>
<p>不透明谓词：在跳转前就已经确定的不等式，但是IDA无法分析，例如<code> y &gt; 10 || x * (x + 1) % 2 == 0</code>这个不等式，大家都知道<code>x * (x + 1) % 2 == 0</code>这个式子是恒成立的，因此刚才这个不等式是恒成立的，当然这是我们知道，而IDA就不知道了，IDA不确定x，y的值，因此无法识别出来，因此就可以增加虚假控制流。</p>
<p>不透明谓词是研究反虚假控制流的重点，因此不透明谓词除了永真&#x2F;永假型、还有可真可假型，而现在的研究都在此基础上进行了深入研究，所以不透明谓词的研究也成为难点。</p>
<p>不可达基本块，是指在虚假控制流中一些基本块是永远不可能执行的，这也是进一步去增加代码的复杂程度</p>
<h4 id="1-2-3-控制流平坦化（Fla）"><a href="#1-2-3-控制流平坦化（Fla）" class="headerlink" title="1.2.3 控制流平坦化（Fla）"></a>1.2.3 控制流平坦化（Fla）</h4><p>控制流平坦化，主要通过一个主分发器来控制程序基本块的执行流程。该方法将所有基本代码放到控制流最底部，然后删除原理基本块之间跳转关系，添加次分发器来控制分发逻辑，然后过新的复杂分发逻辑还原原来程序块之间的逻辑关系。</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/5.png" alt="image-20220921210110215"></p>
<p>我们在阅读源码后，会发现逻辑十分清晰，Ollvm的基本流程：</p>
<ul>
<li>​	添加一个随机数种子 blockID</li>
<li>​    保存所有的基本块</li>
<li>​    将代码中含有switch改为if</li>
<li>​    删除第一个基本块，第一个需要特殊处理</li>
<li>​    识别main中的if,并且删除跳转指令</li>
<li>​    插入一个switch指令</li>
<li>​    第一个块跳转到loopEntry块</li>
<li>​    把所有的block保存到switch语句</li>
<li>重新计算switch变量的值</li>
<li>​    处理不是条件跳转 直接删除jump 跳转到loopEnd 进行下一轮循环</li>
<li>​    处理条件跳转 对真分支和假分支进行相应处理 真则选择真的ID</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">先将里面含switch的改为if-else，再将所有的if-else变为Switch的结果，所以多次进行控制流平坦化就会变得越来越复杂</span><br></pre></td></tr></table></figure>

<h4 id="1-2-4-字符串加密"><a href="#1-2-4-字符串加密" class="headerlink" title="1.2.4 字符串加密"></a>1.2.4 字符串加密</h4><p>字符串加密的原理很简单，编写一个pass将其中的字符串信息使用一些加密算法进行加密，然后特定的时间进行还原。一般含有字符串混淆、函数名混淆、不在init_array解密等</p>
<h2 id="2-Ollvm反混淆"><a href="#2-Ollvm反混淆" class="headerlink" title="2.Ollvm反混淆"></a>2.Ollvm反混淆</h2><p>ollvm反混淆主要思路基本上就是静态分析和动态分析，基本的流程大体都是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">（1）找到所有基本块（特征匹配或机器学习） 控制流平坦化中区分虚假块和真实块是难点</span><br><span class="line">（2）动静态分析找到真实块的联系</span><br><span class="line">	静态分析：符号执行/反编译器提供的IL的API</span><br><span class="line">	动态分析：模拟指令/IDA trace             </span><br><span class="line">（3）编写相应的patch脚本，进行还原原程序</span><br></pre></td></tr></table></figure>

<h3 id="2-1-指令替换"><a href="#2-1-指令替换" class="headerlink" title="2.1 指令替换"></a>2.1 指令替换</h3><p>指令替换一般可以使用llvm的pass进行优化，或者使用Miasm框架进行匹配，然后优化处理即可，由于指令替换一般不会影响程序整体逻辑，这里我们不进行深究。</p>
<h3 id="2-2-反字符串加密"><a href="#2-2-反字符串加密" class="headerlink" title="2.2 反字符串加密"></a>2.2 反字符串加密</h3><p>字符串加密的的常规解决方式：</p>
<p><strong>（1）特征搜索</strong></p>
<p>一般在so中可以直接搜索<code>datadiv_decode</code>，一般很多编写解密函数进行操作是这个函数，针对这种情况，一般可以通过frida hook就可以拿到解密后的值，然后进行patch</p>
<p><strong>（2）init_array中解密</strong></p>
<p>字符串解密操作在init_arrray中进行，一般可以通过模拟执行init_array，然后将解密后的字符串全部保存下来</p>
<p><strong>（3）jni_onload解密</strong></p>
<p>在jni_onload函数中进行解密操作，这时候就要进行inlinehook拿到解密后寄存器的值，也可以进行hook，也可以使用unicorn进行操作</p>
<h3 id="2-3-反虚假控制流"><a href="#2-3-反虚假控制流" class="headerlink" title="2.3 反虚假控制流"></a>2.3 反虚假控制流</h3><p>虚假控制流去除的思路一般为除去不可达块和不透明谓词。但是难点在于不透明谓词，现在不透明谓词的研究不断发展，有永真&#x2F;永假型不透明谓词，也有可真可假型不透明谓词。当然针对复杂的虚假控制流，在反混淆过程中还需要考虑死循环等问题</p>
<p><strong>不透明谓词：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">永真/假型：插入的后续基本块中必有一个不被执行</span><br><span class="line">可真可假型：插入的两个后继基本块的语义应相同</span><br></pre></td></tr></table></figure>

<p>针对简单的控制流混淆，去不透明谓词的思想主要是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">（1）不直接处理不透明谓词，通过让不透明谓词的变量地址可读，则IDA便可以优化</span><br><span class="line">（2）直接将不透明谓词赋值为0或者将不透明谓词中变量x，y赋值为0</span><br><span class="line">（3）编译器优化去干掉不透明谓词</span><br></pre></td></tr></table></figure>

<p><strong>不可达块：</strong></p>
<p>不可达块是指控制流永远无法到达的基本块，一般我们可以使用符号执行或模拟执行来除去不可达基本块</p>
<h3 id="2-4-反控制流平坦化"><a href="#2-4-反控制流平坦化" class="headerlink" title="2.4 反控制流平坦化"></a>2.4 反控制流平坦化</h3><p>一般通用的反控制流平坦化思路：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">（1）先保存所有的基本块</span><br><span class="line">（2）区分真实块和分发器（虚假块） 一般通过规则匹配来做，但是并无法使用所有情况 （难点）</span><br><span class="line">（3）连接真实块的顺序  一般静态可以通过IDA trace然后编写IDApython脚本，动态可以通过符号执行、模拟执行</span><br><span class="line">（4）编写patch修复  对目标函数进行修复、恢复原始逻辑</span><br></pre></td></tr></table></figure>

<p><strong>（1）保存所有的基本块</strong></p>
<p>控制流平坦化本质逻辑是把原始的基本块都碎片化，再通过switch-case语句，对函数的执行流进行重建。那么反混淆的时候，可以尝试根据主分发器将这些执行链给一条条的拆解出来，具体划分为三类：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">入口链：原始函数代码的入口逻辑链，为序言到主分发器的执行路径</span><br><span class="line">循环链：入口及出口均为主分发器的流程链，对应混淆过程中的循环体</span><br><span class="line">Return链：指代入口为主分发器，出口为目标函数结束地址的流程链</span><br></pre></td></tr></table></figure>

<p><strong>（2）区分真实块和分发器</strong></p>
<p>其中入口链没有分发器这样的控制块，所以代码全是真实指令。所以主要是找出循环链及Return链中的真实块，一般有几种思路：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">（1）通过特征匹配来找真实块</span><br><span class="line">（2）真实块的入口跳转地址必须为绝对的比较指令，如beq、bne，首次匹配到这种绝对的跳转指令，就能定位对应流程链中的真实入口地址，然后识别真是快</span><br><span class="line">（3）凡是有内存操作的以及有bl/blx函数调用的都是真实块，其中有一些指向主分发器的虚拟块也会包含内存操作</span><br></pre></td></tr></table></figure>

<p>主分发器的确定：直接遍历目标函数下的所有基本块，并计算每一个Block的引用次数，数量最多的那个就是主分发器</p>
<p><strong>（3）连接真实块的顺序</strong></p>
<p>通过判断movwne&#x2F;movtne r1指令的地址是否大于mov r1，如果大于就说明此真实块会有两条路径去指向两个基本块。对于有两条路径的真实块就需要寻找两次分别去寻找两条路径下对应的真实块，而对于没有两条路径的真实块就直接寻找一次路径就ok了</p>
<p>一般我们使用模拟执行能解决该问题，但遇到上面情况并需要相应的手动修改</p>
<p><strong>（4）编写patch</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.打patch，即通过jump指令或者一些条件跳转指令试图将它们重新连接起来</span><br><span class="line">2.提取出所有真实块的指令，并根据它们之间的关系，计算相对偏移，据此对函数进行重构</span><br></pre></td></tr></table></figure>

<p>前者简单，但是适用性不强，后者复杂，但是工作量大。这里我们主要介绍第一种patch</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(1)把无用块都改成nop指令</span><br><span class="line">(2)针对没有产生分支的真实块把最后一条指令改成jmp指令跳转到下一真实块</span><br><span class="line">(3)产生分支的真实块把CMOV指令改成相应的条件跳转指令跳向符合条件的分支，例如CMOVZ 改成JZ ，再在这条之后添加JMP 指令跳向另一分支</span><br></pre></td></tr></table></figure>



<h2 id="3-Ollvm反混淆实操"><a href="#3-Ollvm反混淆实操" class="headerlink" title="3.Ollvm反混淆实操"></a>3.Ollvm反混淆实操</h2><p>这里收集了一些网上开源的脚本和样例，便于大家学习</p>
<h3 id="3-1反字符串加密"><a href="#3-1反字符串加密" class="headerlink" title="3.1反字符串加密"></a>3.1反字符串加密</h3><p>首先我们打开一个字符串加密的样本</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/6.png" alt="image-20220922172044918"></p>
<p>我们可以发现导出函数中有<code>datadiv_decode</code>字段，我们初步判定就是在该函数中完成对字符串的加密</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/7.png" alt="image-20220922172239875"></p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/8.png" alt="image-20220922172318658"></p>
<p>很明显发现这些函数进行了字符串加密</p>
<p>我们在查看加密函数<code>datadiv_decode</code>的交叉引用，可以很明显的发现在init_array中完成了对字符串的解密</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/9.png" alt="image-20220922172516725"></p>
<p>下面我们使用模拟执行的方法来去除ollvm 字符串加密</p>
<h4 id="3-1-1-AndroidNativeEmu"><a href="#3-1-1-AndroidNativeEmu" class="headerlink" title="3.1.1 AndroidNativeEmu"></a>3.1.1 AndroidNativeEmu</h4><p>AndroidNativeEmu是基于Unicorn的框架，主要解决Unicorn不支持第三方库、JNI_Onload调用等问题</p>
<p>反混淆思路：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">我们分析得知，字符串解密一定在init_array运行完结束，将字符串读取到内存，因此我们运行init_array，然后将内存中解密的字符串保存下来即可</span><br></pre></td></tr></table></figure>

<p>运行环境：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">（1）不使用AndroidNativeEmu项目，可以直接安装 pip install androidemu</span><br><span class="line">（2）也可以去原仓库进行下载</span><br></pre></td></tr></table></figure>

<p>这里我采用第一种环境，解密脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> unicorn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> androidemu.emulator <span class="keyword">import</span> Emulator</span><br><span class="line"></span><br><span class="line">logging.basicConfig( <span class="comment"># 设置日志</span></span><br><span class="line">    stream=sys.stdout,</span><br><span class="line">    level=logging.DEBUG,</span><br><span class="line">    <span class="built_in">format</span>=<span class="string">&#x27;%(asctime)s %(levelname)7s %(name)34s | %(message)s&#x27;</span></span><br><span class="line">)</span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">emulator = Emulator(vfp_inst_set=<span class="literal">True</span>, vfs_root=<span class="string">&#x27;vfs&#x27;</span>) <span class="comment"># 创建模拟器</span></span><br><span class="line">str_datas = &#123;&#125;</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hook_mem_write</span>(<span class="params">uc,<span class="built_in">type</span>,address,size,value,userdata</span>): <span class="comment"># 当发生写内存操作时进行Hook</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        curdata = struct.pack(<span class="string">&quot;I&quot;</span>, value)[:size]</span><br><span class="line">        str_datas[address] = curdata</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(size)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">emulator.mu.hook_add(UC_HOOK_MEM_WRITE,hook_mem_write) <span class="comment"># 添加Hook，需在加载so前</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#emulator.load_library(&#x27;libc.so&#x27;,do_init=False) # 补充加载libc.so，不然可能会有问题</span></span><br><span class="line"></span><br><span class="line">lib_module = emulator.load_library(<span class="string">&#x27;obf.so&#x27;</span>,do_init=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">base_addr = lib_module.base</span><br><span class="line">sodata = <span class="built_in">open</span>(<span class="string">&#x27;obf.so&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line"><span class="keyword">for</span> address,value <span class="keyword">in</span> str_datas.items():</span><br><span class="line">    <span class="keyword">if</span> base_addr &lt; address &lt; base_addr + lib_module.size: <span class="comment"># 判断是否是我们需要的so文件内存空间</span></span><br><span class="line">        offset = address - base_addr -<span class="number">0x1000</span> <span class="comment"># 加载的基址还多了个0x1000</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;address:0x%x data:%s offset:0x%x &#x27;</span> % (address, value, offset+<span class="number">0x1000</span>))</span><br><span class="line">        sodata = sodata[:(offset)] + value + sodata[offset+<span class="built_in">len</span>(value):] <span class="comment"># 将解密后的字符串写回</span></span><br><span class="line"><span class="comment">#print(&quot;sodata&quot;+str(sodata[:0x3810]))</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;obf_new.so&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    file.write(sodata)</span><br><span class="line">file.close()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">上面脚本中：</span><br><span class="line">obf.so为目标样本</span><br><span class="line">如果在框架中运行，需要导入libc.so</span><br><span class="line">最重要需要注意由于IDA偏移和绝对地址不对 需要offset-0x1000</span><br></pre></td></tr></table></figure>

<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/10.png" alt="image-20220922173658071"></p>
<p>运行脚本，得到结果</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/11.png" alt="image-20220922173829174"></p>
<p>修复前后的so对比：</p>
<p>原so:</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/12.png" alt="image-20220922173934780"></p>
<p>修复so：</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/13.png" alt="image-20220922174035699"></p>
<h4 id="3-1-2-IDA插件"><a href="#3-1-2-IDA插件" class="headerlink" title="3.1.2 IDA插件"></a>3.1.2 IDA插件</h4><p>上面我们使用Unicorn进行了模拟调用，很显然我们还可以制作成相应的IDApython脚本，通过插件来进行动态的查看</p>
<p>参考链接：<a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-268108.htm">使用unicorn对ollvm字符串进行解密</a></p>
<p>环境支持：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pip install unicorn  IDApython安装unicorn</span><br><span class="line">Ida 7.x</span><br><span class="line">python3</span><br><span class="line">uEmu.py</span><br></pre></td></tr></table></figure>

<p>脚本：uEmu.py 代码太长  <a target="_blank" rel="noopener" href="https://github.com/alexhude/uEmu%EF%BC%88%E6%88%96%E8%80%85%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E5%9B%9E%E5%A4%8D%EF%BC%9AOllvm%EF%BC%8C%E6%89%80%E6%9C%89%E8%84%9A%E6%9C%AC%E8%87%AA%E5%8F%96%EF%BC%89">https://github.com/alexhude/uEmu（或者微信公众号回复：Ollvm，所有脚本自取）</a></p>
<p>脚本导入操作：复制uEmu.py到IDA_Pro_7.5\plugins\下，重启ida</p>
<p>首先我们找到加密函数，设置起始和结束断点：</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/14.png" alt="image-20220922175139399"></p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/15.png" alt="image-20220922175209878"></p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/16.png" alt="image-20220922175235173"></p>
<p>然后我们右键，此时出现uEmu</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/17.png" alt="image-20220922175347552"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">start命令:通过映射所有段并设置 Unicorn 来初始化模拟器</span><br><span class="line">run命令: 模拟指令，直到到达断点或发生错误</span><br><span class="line">Step模拟一条或 N 条指令（按住ALT/OPTION指定一个数字）</span><br><span class="line">stop:中断仿真</span><br><span class="line">Reset:重置仿真引擎并取消映射所有内存区域</span><br><span class="line">Jump to Pc: 只是跳转到当前 PC</span><br><span class="line">Change CPU context: 可以手动或通过 JSON 文件更新 CPU 上下文（见下文）</span><br><span class="line">Show Controls  显示带有 Start/Run/Step/Stop 按钮的窗口</span><br><span class="line">Show CPU Context 显示带有可用寄存器的窗口</span><br><span class="line">Show CPU Extended Context 显示带有扩展寄存器 (FP/SIMD) 的窗口</span><br><span class="line">Show Stack 显示带有当前 Stack 的窗口</span><br><span class="line">Show Memory Range 允许显示特定的内存区域</span><br></pre></td></tr></table></figure>

<p>我们点击start启动初始化模拟器，并不断确定</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/18.png" alt="image-20220922175704258"></p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/19.png" alt="image-20220922175725288"></p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/20.png" alt="image-20220922175805710"></p>
<p>我们可以使用快捷键<code>ctrl+shfit+alt+s</code>进行快速单步步过</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/21.png" alt="image-20220922180009607"></p>
<p>可以选择一次步过多少条指令</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/22.png" alt="image-20220922184945143"></p>
<p>此时我们查看0x4004处的字符串，右键uEMu–&gt;Show Memory Range</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/23.png" alt="image-20220922185053241"></p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/24.png" alt="image-20220922185122178"></p>
<p>可以看见此时的还是加密的QUR，还未解密，我们也可以在so中看到</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/25.png" alt="image-20220922185226245"></p>
<p>我们继续调试，按照我们上面的结果，这里应该为jni.go into _ini，这里我们可以直接下断点，然后run过去</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/26.png" alt="image-20220922191223988"></p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/27.png" alt="image-20220922190331570"></p>
<p>可以发现很好的进行了解密，其实原理和上面一样</p>
<h3 id="3-2-反虚假控制流"><a href="#3-2-反虚假控制流" class="headerlink" title="3.2 反虚假控制流"></a>3.2 反虚假控制流</h3><h4 id="3-2-1-符号执行"><a href="#3-2-1-符号执行" class="headerlink" title="3.2.1 符号执行"></a>3.2.1 符号执行</h4><p>环境要求：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">安装angr pip install angr==8.19.4.5   angr版本为8.19.4.5</span><br></pre></td></tr></table></figure>

<p>我们打开一个虚假控制流混淆后的样本</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/28.png" alt="image-20220922200516763"></p>
<p>很明显我们在这里看到了一些不透明谓词，这是一个虚假控制流混淆处理后的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python debogus.py -f target_arm_bogus --addr 0x83B4</span><br></pre></td></tr></table></figure>

<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/29.png" alt="image-20220922200812611"></p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/30.png" alt="image-20220922200840974"></p>
<p>这里我们打开修复后的样本</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/31.png" alt="image-20220922201047300"></p>
<p>可以看到一些不可达块填充为nop</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/32.png" alt="image-20220922201128282"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 去除虚假控制流 idapython脚本</span></span><br><span class="line"><span class="keyword">import</span> ida_xref</span><br><span class="line"><span class="keyword">import</span> ida_idaapi</span><br><span class="line"><span class="keyword">from</span> ida_bytes <span class="keyword">import</span> get_bytes, patch_bytes</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 将 mov 寄存器, 不透明谓词 修改为 mov 寄存器, 0</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">do_patch</span>(<span class="params">ea</span>):</span><br><span class="line">    <span class="keyword">if</span> get_bytes(ea, <span class="number">1</span>) == <span class="string">b&quot;\x8B&quot;</span>: <span class="comment"># mov eax-edi, dword</span></span><br><span class="line">        reg = (<span class="built_in">ord</span>(get_bytes(ea + <span class="number">1</span>, <span class="number">1</span>)) &amp; <span class="number">0b00111000</span>) &gt;&gt; <span class="number">3</span></span><br><span class="line">        patch_bytes(ea, (<span class="number">0xB8</span> + reg).to_bytes(<span class="number">1</span>,<span class="string">&#x27;little&#x27;</span>) + <span class="string">b&#x27;\x00\x00\x00\x00\x90&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;error&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 不透明谓词在.bss段的范围</span></span><br><span class="line">start = <span class="number">0x0011028</span></span><br><span class="line">end = <span class="number">0x0011030</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> addr <span class="keyword">in</span> <span class="built_in">range</span>(start,end,<span class="number">4</span>):</span><br><span class="line">    ref = ida_xref.get_first_dref_to(addr)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(addr).center(<span class="number">20</span>,<span class="string">&#x27;-&#x27;</span>))</span><br><span class="line">    <span class="comment"># 获取所有交叉引用</span></span><br><span class="line">    <span class="keyword">while</span>(ref != ida_idaapi.BADADDR):</span><br><span class="line">        do_patch(ref)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;patch at &#x27;</span> + <span class="built_in">hex</span>(ref))</span><br><span class="line">        ref = ida_xref.get_next_dref_to(addr, ref)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;-&#x27;</span> * <span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-模拟执行"><a href="#3-2-2-模拟执行" class="headerlink" title="3.2.2 模拟执行"></a>3.2.2 模拟执行</h4><p>使用基于Unicorn的框架可以去虚假控制流，思路如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">（1）通过Unicorn模拟执行目标函数，并记录可达块和不可达块的地址，将可达块的地址全部报错</span><br><span class="line">（2）编写IDApython脚本，将不可达块地方全部填充为nop，就可以除去虚假控制流</span><br></pre></td></tr></table></figure>

<p>参考文章：<a target="_blank" rel="noopener" href="http://missking.cc/2021/05/14/ollvm3/">http://missking.cc/2021/05/14/ollvm3/</a></p>
<h3 id="3-3-反控制流平坦化"><a href="#3-3-反控制流平坦化" class="headerlink" title="3.3 反控制流平坦化"></a>3.3 反控制流平坦化</h3><h4 id="3-3-1-符号执行"><a href="#3-3-1-符号执行" class="headerlink" title="3.3.1 符号执行"></a>3.3.1 符号执行</h4><p>环境：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">安装angr pip install angr==8.19.4.5   angr版本为8.19.4.5</span><br></pre></td></tr></table></figure>

<p>我们先打开一个控制流平坦化的样本</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/33.png" alt="image-20220922213932982"></p>
<p>这是一个标准的控制流平坦化的样本，我们可以看见序言、主分发器、次分发器、结束块等</p>
<p>我们通过符号执行来除去：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python deflat.py -f samples/<span class="built_in">bin</span>/check_passwd_arm_flat --addr <span class="number">0x83B0</span>(目标函数地址)</span><br></pre></td></tr></table></figure>

<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/34.png" alt="image-20220922214629123"></p>
<p>我们将修复后的样本打开：</p>
<p>原样本：</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/36.png" alt="image-20220922214902748"></p>
<p>去除混淆后的样本：</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/35.png" alt="image-20220922214827404"></p>
<h4 id="3-3-2-模拟执行"><a href="#3-3-2-模拟执行" class="headerlink" title="3.3.2 模拟执行"></a>3.3.2 模拟执行</h4><p>环境要求：</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/43.png" alt="image-20220922220425663"></p>
<p>我们打开另外一个样本</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/38.png" alt="image-20220922215820915"></p>
<p>定位到函数的起始和终止 </p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/39.png" alt="image-20220922215854085"></p>
<p>然后启动脚本</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/37.png" alt="image-20220922215709565"></p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/40.png" alt="image-20220922215934225"></p>
<p>打开修复后的样本</p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/41.png" alt="image-20220922220136390"></p>
<p><img src="https://bugs-1307040378.cos.ap-chengdu.myqcloud.com/0008/42.png" alt="image-20220922220154180"></p>
<h2 id="4-总结"><a href="#4-总结" class="headerlink" title="4.总结"></a>4.总结</h2><p>本文初步的简单介绍了当前Ollvm反混淆中的一些方法并进行了复现，样本的实例都来自于当前研究该领域的各个大佬开源脚本，这里就不一一提及了，感兴趣朋友可以查看参考文献。</p>
<p>本实验的实验样本全部上传至知识星球：安全后厨</p>
<p>本实验的全部脚本全部上传至github：<a target="_blank" rel="noopener" href="https://github.com/WindXaa/Android-reverse">WindXaa</a>或微信公众号：安全后厨</p>
<h2 id="5-参考文章"><a href="#5-参考文章" class="headerlink" title="5.参考文章"></a>5.参考文章</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://bbs.pediy.com/thread-268108.htm#msg_header_h1_0</span><br><span class="line">http://missking.cc/2020/11/03/unicorn2/</span><br><span class="line">https://bbs.pediy.com/thread-266005.htm</span><br></pre></td></tr></table></figure>

<p>虚假控制流：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">https://bbs.pediy.com/thread-257213.htm</span><br><span class="line">https://github.com/llxiaoyuan/llux</span><br><span class="line">https://bbs.pediy.com/thread-257213.htm</span><br><span class="line">https://github.com/cq674350529/deflat</span><br></pre></td></tr></table></figure>

<p>控制流平坦化：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnblogs.com/revercc/p/16339476.html</span><br><span class="line">https://www.wireghost.cn/2020/08/28/OLLVM%E9%80%9A%E7%94%A8%E5%8F%8D%E5%B9%B3%E5%9D%A6%E5%8C%96%E7%A0%94%E7%A9%B6/</span><br><span class="line">https://security.tencent.com/index.php/blog/msg/112</span><br><span class="line">https://bbs.pediy.com/thread-271557.htm</span><br></pre></td></tr></table></figure>


    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>安全后厨团队 |  微信公众号【安全后厨】
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://security-kitchen.com/2023/02/09/bug0008/" title="Android App漏洞之战（8）——（反混淆）Ollvm混淆与反混淆">http://security-kitchen.com/2023/02/09/bug0008/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/" rel="tag"># 漏洞挖掘</a>
              <a href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag"># 工具</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/02/09/bug0007/" rel="prev" title="Android App漏洞之战（7）——（脱壳篇）整体壳脱壳技巧详解">
      <i class="fa fa-chevron-left"></i> Android App漏洞之战（7）——（脱壳篇）整体壳脱壳技巧详解
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/02/13/bug0009/" rel="next" title="Android App漏洞之战（9）——Activity漏洞挖掘详解">
      Android App漏洞之战（9）——Activity漏洞挖掘详解 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Ollvm"><span class="nav-text">1.Ollvm</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-ollvm%E7%AE%80%E4%BB%8B"><span class="nav-text">1.1 ollvm简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-ollvm%E5%88%86%E7%B1%BB"><span class="nav-text">1.2 ollvm分类</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-1-%E6%8C%87%E4%BB%A4%E6%9B%BF%E6%8D%A2%EF%BC%88Sub%EF%BC%89"><span class="nav-text">1.2.1 指令替换（Sub）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-2-%E8%99%9A%E5%81%87%E6%8E%A7%E5%88%B6%E6%B5%81%EF%BC%88bcf%EF%BC%89"><span class="nav-text">1.2.2 虚假控制流（bcf）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-3-%E6%8E%A7%E5%88%B6%E6%B5%81%E5%B9%B3%E5%9D%A6%E5%8C%96%EF%BC%88Fla%EF%BC%89"><span class="nav-text">1.2.3 控制流平坦化（Fla）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-4-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8A%A0%E5%AF%86"><span class="nav-text">1.2.4 字符串加密</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Ollvm%E5%8F%8D%E6%B7%B7%E6%B7%86"><span class="nav-text">2.Ollvm反混淆</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E6%8C%87%E4%BB%A4%E6%9B%BF%E6%8D%A2"><span class="nav-text">2.1 指令替换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%8F%8D%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8A%A0%E5%AF%86"><span class="nav-text">2.2 反字符串加密</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E5%8F%8D%E8%99%9A%E5%81%87%E6%8E%A7%E5%88%B6%E6%B5%81"><span class="nav-text">2.3 反虚假控制流</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-%E5%8F%8D%E6%8E%A7%E5%88%B6%E6%B5%81%E5%B9%B3%E5%9D%A6%E5%8C%96"><span class="nav-text">2.4 反控制流平坦化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Ollvm%E5%8F%8D%E6%B7%B7%E6%B7%86%E5%AE%9E%E6%93%8D"><span class="nav-text">3.Ollvm反混淆实操</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1%E5%8F%8D%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8A%A0%E5%AF%86"><span class="nav-text">3.1反字符串加密</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-1-AndroidNativeEmu"><span class="nav-text">3.1.1 AndroidNativeEmu</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-2-IDA%E6%8F%92%E4%BB%B6"><span class="nav-text">3.1.2 IDA插件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E5%8F%8D%E8%99%9A%E5%81%87%E6%8E%A7%E5%88%B6%E6%B5%81"><span class="nav-text">3.2 反虚假控制流</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-%E7%AC%A6%E5%8F%B7%E6%89%A7%E8%A1%8C"><span class="nav-text">3.2.1 符号执行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-2-%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8C"><span class="nav-text">3.2.2 模拟执行</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E5%8F%8D%E6%8E%A7%E5%88%B6%E6%B5%81%E5%B9%B3%E5%9D%A6%E5%8C%96"><span class="nav-text">3.3 反控制流平坦化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-1-%E7%AC%A6%E5%8F%B7%E6%89%A7%E8%A1%8C"><span class="nav-text">3.3.1 符号执行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-2-%E6%A8%A1%E6%8B%9F%E6%89%A7%E8%A1%8C"><span class="nav-text">3.3.2 模拟执行</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E6%80%BB%E7%BB%93"><span class="nav-text">4.总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="nav-text">5.参考文章</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="安全后厨团队"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">安全后厨团队</p>
  <div class="site-description" itemprop="description">选择有时候比努力更重要</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">52</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/WindXaa" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;WindXaa" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://bbs.pediy.com/user-home-905443.htm" title="看雪 → https:&#x2F;&#x2F;bbs.pediy.com&#x2F;user-home-905443.htm" rel="noopener" target="_blank"><i class="gratipay fa-fw"></i>看雪</a>
      </span>
  </div>



      </div>
	  
	  <div class="wechat_OA">
		<span><b>公众号</b></span>
		<br>
		<!-- 这里添加你的二维码图片 -->
		<img src="https://blog-1307040378.cos.ap-chengdu.myqcloud.com/blog-website/weChat.jpg" alt="二维码">
	  </div>
	  <div class="wechat_OA">
		<span><b>知识星球</b></span>
		<br>
		<!-- 这里添加你的二维码图片 -->
		<img src="https://blog-1307040378.cos.ap-chengdu.myqcloud.com/blog-website%2Fstar.png" alt="知识星球">
	  </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2022-12 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">安全后厨团队</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>
<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共189.4k字</span>
</div>

    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">总访客数<span id="busuanzi_value_site_uv"></span>人</span>
    <span class="post-meta-divider">|</span>
<!-- 不蒜子计数初始值纠正 -->
<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var countOffset = 20000;  // 初始化首次数据

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset); // 加上初始数据 
            clearInterval(int); // 停止检测
        }  
    }
       	
});
</script> 


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
